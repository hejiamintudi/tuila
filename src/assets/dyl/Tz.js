"use strict";var getNowTime=function(){let e=new Date;return[e.getSeconds(),e.getMilliseconds()]};window.tz=function(e,...t){let n=!1;n=!0;let o="",r=[],c=[],l=-1,f=function(e){return e},i=function(e){cc.sys.isMobile||DylIsFinal?cc.log(e):console.log("%c"+o+String(e),"color:#fe8bd9;font-weight:bold;")},u=null;"object"==typeof e&&e.getChildren?u=e:(u=cc.director.getScene().getChildren()[0],t=[e,...t]);let s=[],a=null,p=null,y=function(){};c.push(y);let d=function(e){let t=y;y=f(y=function(){i("sameArr"),r=[];let n=e.length+1,o=function(){--n||t()};for(let t=e.length-1;t>=0;t--){let n=e[t];if("number"==typeof n)return cc.error("tz \u540c\u6b65\u52a8\u4f5c\u4e0d\u80fd\u63a5\u53d7 \u5faa\u73af\u64cd\u4f5c");if("function"==typeof n){if(n.actArr)for(let e=0;e<n.actArr.length;e++){let t=n.actArr[e];r.push({node:t.node,act:t})}let e=f(o);n(e)||e();continue}let c=cc.callFunc(o),l=cc.sequence(n,c);n.node.active||cc.warn("\u8fd9\u4e2a\u8282\u70b9 active \u4e3a false","sameArr"),r.push({node:n.node,act:l}),n.node.runAction(l)}o()})},g=function(e){let t=null;if(Array.isArray(e)){let t=e;e=function(){let e=[],n=function(t,n){for(let o=e.length-1;o>=0;o--)e[o][t]=n},o=function(t){for(let n=e.length-1;n>=0;n--){let o=!0===t.x?e[n].x:t.x,r=!0===t.y?e[n].y:t.y;e[n].setPosition(o,r)}};for(let r=0;r<t.length;r++){let c=t[r],l=null;if(l=c&&"object"==typeof c&&!c.getChildren&&void 0!==c.x&&void 0!==c.y?"cc.Vec2":cc.js.getClassName(c),Array.isArray(c))c.length<1&&(e=c),"number"==typeof c[0]?1===c.length?n("rotate",c):n("scale",cc.v2(c[0],c[1])):e=c;else if("cc.Node"===l)e=[c];else if("boolean"==typeof c)n("active",c);else if("cc.Color"===l)n("color",c);else if("cc.Vec2"===l)o(c);else if("number"==typeof c)n("opacity",c);else{if("string"!=typeof c)return cc.error("\u5b8c\u5168\u4e0d\u77e5\u9053\u600e\u4e48\u5904\u7406",c);if("function"==typeof e[0][c])if(Array.isArray(t[r+1])){r++;for(let n=0;n<e.length;n++)e[n][c](...t[r])}else for(let t=0;t<e.length;t++)e[t][c]();else n(c,t[++r])}}}}if("string"==typeof e){let t=e;""===o&&(o=t+" "),e=function(){cc.log(t)}}if("function"==typeof e){t=(t=>e(t))}else"number"==typeof e?t=e<0?-e:isNaN(e)?-1:cc.delayTime(e):cc.error("\u53c2\u6570\u6709\u95ee\u9898,\u8fd9\u91cc\u4e0d\u63a5\u53d7\u5176\u4ed6\u53c2\u6570",e);return"function"==typeof t?(t.node=u,t.actName="function"):"number"!=typeof t&&(t.node=u,t.actName=e),t},h=function(...e){if(void 0===e[0])return-1!==l?cc.warn("tz \u5df2\u7ecf\u8fd0\u884c\u8fc7\u4e86\uff0c\u4e0d\u80fd\u518d\u7528\u4e86"):(l=!1,function(){if(a)return cc.error("\u540c\u65f6\u8fd0\u884c\u7684\u52a8\u4f5c\uff0c\u6ca1\u6709\u7ed3\u675f");if("number"==typeof s[0])return cc.error("tz \u4e00\u5f00\u59cb\u4e0d\u80fd\u662f\u5faa\u73af\u6570\uff0c\u56e0\u4e3a\u6ca1\u6709\u52a8\u4f5c\u53ef\u4ee5\u5faa\u73af");"number"!=typeof s[s.length-1]&&s.push(1);for(let e=s.length-1;e>=0;e--){let t=s[e];if(Array.isArray(t)){d(t);continue}let n=y;if("function"==typeof t){y=f(()=>{if(i(t.actName),r=[],t.actArr)for(let e=0;e<t.actArr.length;e++){let n=t.actArr[e];r.push({node:n.node,act:n})}t(n)||n()});continue}if("number"==typeof t){if("number"==typeof s[e-1])return cc.warn("tz \u8fde\u7eed\u8fd9\u91cc\u6709\u4e00\u4e2a\u5faa\u73af\u4f53\u4e3a\u7a7a\uff0c\u5c31\u662f\u8fde\u7eed\u4e24\u4e2a\u53c2\u6570\u4e3a\u8d1f\u6570");let n=c.length;c[n-1].oriEndFun=y;let o=t;y=(()=>{i(-1===t?"\u65e0\u9650\u5faa\u73af":"\u8fd8\u5269\u5faa\u73af\u6b21\u6570 "+String(o)),r=[],o--?c[n].oriEndFun():c[n-1]()}),c.push(y);continue}let o=cc.callFunc(function(){n()}),l=cc.sequence(t,o);y=f(y=function(){i(t.actName),r=[{node:t.node,act:l}],t.node.active||cc.warn("\u8fd9\u4e2a\u8282\u70b9 active \u4e3a false",t.actName),t.node.runAction(l)})}c[c.length-1].oriEndFun=y,c[c.length-1]()}(),p);if(null===e[0]){if(-1===l)return cc.warn("tz \u8fd8\u6ca1\u6709\u5efa\u7acb\u8fd0\u884c"),p;if(0===r.length)return p;for(var t=r.length-1;t>=0;t--)r[t].node.stopAction(r[t].act);return l="del",p}if("boolean"==typeof e[0]){if(-1===l)return cc.warn("tz \u8fd8\u6ca1\u6709\u5efa\u7acb\u8fd0\u884c"),p;if("del"===l)return cc.warn("tz \u6240\u6709\u52a8\u4f5c\u90fd\u5220\u9664\u4e86\uff0c\u6ca1\u5fc5\u8981\u6682\u505c\u548c\u6062\u590d\u4e86"),p;if(0===r.length)return cc.warn("tz \u8fd9\u91cc\u6ca1\u6709\u8981\u6682\u505c\u7684\u52a8\u4f5c\u8868\uff0c\u662f\u5426\u90fd\u662f\u51fd\u6570\uff1f"),p;if(e[0]){if(!l)return p;for(t=r.length-1;t>=0;t--)r[t].node.resumeAllActions();l=!1}else{if(l)return p;for(t=r.length-1;t>=0;t--)r[t].node.pauseAllActions();l=!0}return p}for(let t=0;t<e.length;t++){let n=e[t],o=g(n);a?a.push(o):s.push(o)}return p};for(let e=0;e<t.length;e++)void 0!==t[e]&&h(t[e]);return p=new Proxy(h,{get:function(e,t){let n=!1;"_"===t[0]&&(n=!0);let o=t.split("_").pop();return function(e,...t){let r=null;if(""===o)void 0===e&&(e=0),(r=g(e,...t)).actName=e;else if("to"===o||"by"===o){let n=null,l=t[t.length-1];"object"==typeof l&&"function"==typeof l.easing&&"function"==typeof l.reverse&&(t.pop(),n=l),t=[e,...t];let f=0,i=null,s=[],a=[],p=[],y=[];if(Array.isArray(t[0])&&t[0].length<1)(r=function(){}).actName=o;else{Array.isArray(t[f])?"function"==typeof t[f][0].getChildren&&(i=t[f],f++):"function"==typeof t[f].getChildren&&(i=[t[f]],f++),i||(i=[u]),Array.isArray(t[f])&&(a=t[f],f++);let e=0,l=0,d=0,g={pos:null,diff_pos:cc.v2(0,0),now_diff_pos:cc.v2(0,0),rotate:null,diff_rotate:0,now_diff_rotate:0,scale:null,diff_scale:[0,0],now_diff_scale:[0,0],color:null,diff_color:cc.color(0,0,0),now_diff_color:cc.color(0,0,0)};for(;f<t.length;f++){var c=t[f];if("number"==typeof c)e=c;else if("function"==typeof c)p.push(c);else if(Array.isArray(c))1===c.length?g.rotate=c[0]:g.scale=c;else if(c&&"object"==typeof c&&!c.getChildren&&void 0!==c.x&&void 0!==c.y)!0===c.x?c.x=i[0].x:!0===c.y&&(c.y=i[0].y),g.pos=c;else{if("cc.Color"!==cc.js.getClassName(c))return cc.error("tz \u8fd9\u4e2a\u7c7b\u578b\u6211\u4e0d\u77e5\u9053\u600e\u4e48\u5904\u7406",c);g.color=c}}for(f=0;f<a.length;f++)if("number"==typeof a[f])l=a[f],d=l<0?-l*i.length:-l;else if("function"==typeof a[f])y.push(a[f]);else if(Array.isArray(a[f])){if(1===a[f].length){if(g.diff_rotate=a[f][0],null===g.rotate)return cc.error("tz \u6709\u504f\u79fb\u900f\u660e\u5ea6\uff0c\u4f46\u6ca1\u6709\u56fa\u5b9a\u900f\u660e\u5ea6\u8d4b\u503c [number]")}else if(g.diff_scale=a[f],null===g.scale)return cc.error("tz \u6709\u504f\u79fb\u7f29\u653e\uff0c\u4f46\u6ca1\u6709\u56fa\u5b9a\u7f29\u653e\u8d4b\u503c [number, number]")}else if("cc.Vec2"===cc.js.getClassName(a[f])){if(g.diff_pos=a[f],null===g.pos)return cc.error("tz \u6709\u504f\u79fb\u4f4d\u7f6e, \u4f46\u6ca1\u6709\u56fa\u5b9a\u4f4d\u7f6e")}else{if("cc.Color"!==cc.js.getClassName(a[f]))return cc.error("tz \u8fd9\u4e2a\u7c7b\u578b\u6211\u4e0d\u77e5\u9053\u600e\u4e48\u5904\u7406",a[f]);if(g.diff_color=a[f],null===g.color)return cc.error("tz \u6709\u504f\u79fb\u989c\u8272, \u4f46\u6ca1\u6709\u56fa\u5b9a\u989c\u8272")}let h=0,m=null,b=function(e){h=e},A=function(){0==--h&&m()},_=function(e,t,o){let r=cc.callFunc(A);n&&e.easing(n);let c=null;if(o>1e-6){let t=cc.delayTime(o);c=cc.sequence(t,e,r)}else c=cc.sequence(e,r);c.node=t,s.push(c)},v=function(e,t,n){let o={};for(let r=0;r<t.length;r++){let c=t[r](e,n);"number"==typeof c?o.time=c:Array.isArray(c)?1===c.length?o.rotate=c[0]:o.scale=c:"cc.Vec2"===cc.js.getClassName(c)?o.pos=c:"cc.Color"===cc.js.getClassName(c)&&(o.color=c)}return o};if("to"===o)for(f=0;f<i.length;f++){let t=i[f],n=v(f,p,t),o=v(f,y,t),r=e;"number"==typeof n.time&&(r=n.time),"number"==typeof o.time?d=o.time:d+=l;let c=function(e,t){return"pos"===e?cc.moveTo(r,t):"rotate"===e?cc.rotateTo(r,t):"scale"===e?cc.scaleTo(r,t[0],t[1]):"color"===e?cc.tintTo(r,t.r,t.g,t.b):void 0},u=function(e){if("pos"===e)g.pos=g.pos.add(g.diff_pos);else if("rotate"===e)g.rotate+=g.diff_rotate;else if("scale"===e){let[e,t]=g.scale,[n,o]=g.diff_scale;g.scale=[e+n,t+o]}else if("color"===e){let{r:e,g:t,b:n}=g.diff_color;g.color=cc.color(g.color.r+e,g.color.g+t,g.color.b+n)}},s=function(e){if(o[e]&&(g["diff_"+e]=o[e]),n[e]){let o=c(e,n[e]);_(o,t,d),null!==g[e]&&(g[e]=n[e],u(e))}else if(null!==g[e]){let n=c(e,g[e]);_(n,t,d),u(e)}};s("pos"),s("rotate"),s("scale"),s("color")}else if("by"===o)for(f=0;f<i.length;f++){let t=i[f],n=v(f,p,t),o=v(f,y,t),r=e;"number"==typeof n.time&&(r=n.time),"number"==typeof o.time?d=o.time:d+=l;let c=function(e,t){return"pos"===e?cc.moveBy(r,t):"rotate"===e?cc.rotateBy(r,t):"scale"===e?cc.scaleBy(r,t[0],t[1]):"color"===e?cc.tintBy(r,t.r,t.g,t.b):void 0},u=function(e,t,n){if("pos"===e)return t.add(n);if("rotate"===e)return t+n;if("scale"===e){let[e,o]=t,[r,c]=n;return[e+r,o+c]}if("color"===e){let{r:e,g:o,b:r}=t;return cc.color(n.r+e,n.g+o,n.b+r)}},s=function(e){g["now_diff_"+e]=u(e,g["now_diff_"+e],g["diff_"+e])},a=function(e){if(o[e]&&(g["diff_"+e]=o[e]),n[e]){let o=c(e,n[e]);_(o,t,d),null!==g[e]&&(g[e]=n[e])}else if(null!==g[e]){let n=c(e,u(e,g[e],g["now_diff_"+e]));_(n,t,d),s(e)}};a("pos"),a("rotate"),a("scale"),a("color")}else cc.error("tz \u8fd9\u4e2aactName\u7a81\u7136\u53d8\u5f97\u597d\u5947\u602a\uff0c\u4e0d\u662fto\u4e5f\u4e0d\u662fby",o);let w=function(e){m=e,b(s.length+1);for(let e=0;e<s.length;e++){if(!s[e].node.active)return cc.warn(o+"\u5b58\u5728\u8282\u70b9\u7684active\u4e3a\u5426",s[e].node);s[e].node.runAction(s[e])}return A(),!0};w.actName=o,w.actArr=s,r=w}}else{"object"==typeof e&&e.getChildren||(t=[e,...t],e=u);let n=null,c=t[t.length-1];"object"==typeof c&&"function"==typeof c.easing&&"function"==typeof c.reverse&&(t.pop(),n=c),(r=cc[o](...t)).node=e,r.actName=o,n&&r.easing(n)}return n?a?(a.push(r),s.push(a),a=null):a=[r]:a?a.push(r):s.push(r),p}}})};